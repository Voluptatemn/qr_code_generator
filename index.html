<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Custom QR Code Generator</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0b0c10;
      --card: #12141a;
      --muted: #a0a6b3;
      --text: #e9ecf2;
      --accent: #6ee7ff;
      --ring: #2b9dff55;
      --border: #1d2230;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 800px at 80% -10%, #0e1527 0%, var(--bg) 60%);
      color: var(--text);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    .container {
      max-width: 1100px;
      margin: 40px auto;
      padding: 0 20px;
      display: grid;
      grid-template-columns: 1.2fr 1fr;
      gap: 24px;
    }
    header {
      max-width: 1100px;
      margin: 24px auto 0;
      padding: 0 20px;
    }
    .title {
      font-size: 28px;
      font-weight: 800;
      letter-spacing: 0.3px;
    }
    .subtitle { color: var(--muted); margin-top: 4px; }

    .card {
      background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 18px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.25);
      backdrop-filter: blur(6px);
    }
    .section-title { font-size: 14px; color: var(--muted); text-transform: uppercase; letter-spacing: .14em; margin: 8px 0 14px; }

    .controls { display: grid; gap: 14px; }
    .field { display: grid; gap: 8px; }
    .field.inline { grid-template-columns: 1fr auto; align-items: center; gap: 10px; }
    label { font-size: 13px; color: var(--muted); }
    input[type="text"], input[type="number"], input[type="file"], select {
      width: 100%;
      background: #0c1017;
      color: var(--text);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 10px 12px;
      outline: none;
      transition: box-shadow .2s ease, border-color .2s ease;
    }
    input[type="color"] {
      width: 48px; height: 36px; padding: 0; border-radius: 10px; border: 1px solid var(--border); background: #0c1017; cursor: pointer;
    }
    input:focus, select:focus {
      border-color: #2b9dff66;
      box-shadow: 0 0 0 6px var(--ring);
    }
    .row { display: grid; gap: 12px; grid-template-columns: repeat(2, 1fr); }
    .row-3 { display: grid; gap: 12px; grid-template-columns: repeat(3, 1fr); }

    .btns { display: flex; gap: 10px; flex-wrap: wrap; }
    button {
      background: #0e66ff;
      color: white;
      border: none;
      border-radius: 12px;
      padding: 10px 14px;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 8px 20px rgba(14,102,255,0.25);
      transition: transform .05s ease, filter .2s ease, opacity .2s ease;
    }
    button.secondary { background: #1b2537; box-shadow: none; border: 1px solid var(--border); }
    button:active { transform: translateY(1px); }

    .qr-wrap {
      display: grid; place-items: center; min-height: 540px;
      border-radius: 16px; border: 1px dashed var(--border);
      background: radial-gradient(500px 400px at 30% 10%, rgba(255,255,255,0.06) 0%, rgba(255,255,255,0.02) 40%, transparent 70%);
      position: relative;
    }
    .hint { position: absolute; bottom: 12px; font-size: 12px; color: var(--muted); }
    .footer { text-align: center; color: var(--muted); font-size: 12px; margin: 26px 0 40px; }
    .chip { display: inline-flex; align-items: center; gap: 8px; background: #0c1017; border: 1px solid var(--border); padding: 8px 10px; border-radius: 999px; font-size: 12px; color: var(--muted); }
    .chip input[type="checkbox"] { accent-color: #0e66ff; width: 16px; height: 16px; }

    @media (max-width: 980px) {
      .container { grid-template-columns: 1fr; }
      .qr-wrap { min-height: 420px; }
    }
  </style>
  <!-- QR code generator (customizable) -->
  <script src="https://cdn.jsdelivr.net/npm/qr-code-styling@1.6.0/lib/qr-code-styling.js"></script>
</head>
<body>
  <header>
    <div class="title">QR Code Generator</div>
    <div class="subtitle">Paste a URL, tweak the style, and download as PNG or SVG.</div>
  </header>

  <main class="container">
    <!-- Controls -->
    <section class="card" aria-label="Controls">
      <div class="section-title">Content</div>
      <div class="controls">
        <div class="field">
          <label for="data">URL or text</label>
          <input id="data" type="text" placeholder="https://example.com" value="https://example.com" />
        </div>

        <div class="row">
          <div class="field">
            <label for="ec-level">Error correction</label>
            <select id="ec-level">
              <option value="L">L (7%)</option>
              <option value="M" selected>M (15%)</option>
              <option value="Q">Q (25%)</option>
              <option value="H">H (30%)</option>
            </select>
          </div>
          <div class="field">
            <label for="margin">Quiet zone (margin, px)</label>
            <input id="margin" type="number" min="0" max="64" value="8" />
          </div>
        </div>
      </div>

      <div class="section-title" style="margin-top:18px">Appearance</div>
      <div class="controls">
        <div class="row">
          <div class="field">
            <label for="size">Size (px)</label>
            <input id="size" type="number" min="128" max="2048" value="360" />
          </div>
          <div class="field">
            <label for="format">Download format</label>
            <select id="format">
              <option value="png" selected>PNG</option>
              <option value="svg">SVG</option>
              <option value="jpeg">JPEG</option>
              <option value="webp">WEBP</option>
            </select>
          </div>
        </div>

        <div class="row-3">
          <div class="field inline">
            <label for="fg">Foreground</label>
            <input id="fg" type="color" value="#111827" />
          </div>
          <div class="field inline">
            <label for="bg">Background</label>
            <input id="bg" type="color" value="#ffffff" />
          </div>
          <div class="field">
            <label for="dot-style">Dot style</label>
            <select id="dot-style">
              <option value="square">Square</option>
              <option value="dots" selected>Dots</option>
              <option value="rounded">Rounded</option>
              <option value="extra-rounded">Extra Rounded</option>
              <option value="classy">Classy</option>
              <option value="classy-rounded">Classy Rounded</option>
            </select>
          </div>
        </div>

        <div class="row">
          <div class="field">
            <label for="corner-square">Corner squares</label>
            <select id="corner-square">
              <option value="square">Square</option>
              <option value="extra-rounded" selected>Extra Rounded</option>
              <option value="dot">Dot</option>
            </select>
          </div>
          <div class="field">
            <label for="corner-dot">Corner dots</label>
            <select id="corner-dot">
              <option value="square">Square</option>
              <option value="dot" selected>Dot</option>
              <option value="extra-rounded">Extra Rounded</option>
            </select>
          </div>
        </div>

        <div class="row">
          <div class="chip"><input id="transparent" type="checkbox"> Transparent background</div>
          <div class="chip"><input id="auto-contrast" type="checkbox" checked> Auto contrast</div>
        </div>
      </div>

      <div class="section-title" style="margin-top:18px">Logo (optional)</div>
      <div class="controls">
        <div class="row">
          <div class="field">
            <label for="logo">Upload logo</label>
            <input id="logo" type="file" accept="image/*" />
          </div>
          <div class="field">
            <label for="logo-size">Logo size (% of QR)</label>
            <input id="logo-size" type="number" min="5" max="45" value="22" />
          </div>
        </div>
        <div class="row">
          <div class="field">
            <label for="logo-margin">Logo margin (px)</label>
            <input id="logo-margin" type="number" min="0" max="24" value="2" />
          </div>
          <div class="field">
            <label for="logo-bg">Logo background (for PNG/JPEG)</label>
            <input id="logo-bg" type="color" value="#ffffff" />
          </div>
        </div>
      </div>

      <div class="section-title" style="margin-top:18px">Actions</div>
      <div class="btns">
        <button id="update">Generate / Update</button>
        <button id="download" class="secondary">Download</button>
        <button id="copy" class="secondary">Copy to Clipboard</button>
      </div>
    </section>

    <!-- Preview -->
    <section class="card" aria-label="Preview">
      <div class="section-title">Preview</div>
      <div id="qr" class="qr-wrap">
        <div class="hint">Tip: paste a URL, tweak options, then Download.</div>
      </div>
    </section>
  </main>

  <div class="footer">Built with <span aria-label="love">❤️</span> · No tracking, all client‑side</div>

  <script>
    // Utilities
    const $ = (sel) => document.querySelector(sel);
    const dataEl = $('#data');
    const sizeEl = $('#size');
    const ecEl = $('#ec-level');
    const marginEl = $('#margin');
    const fgEl = $('#fg');
    const bgEl = $('#bg');
    const transparentEl = $('#transparent');
    const autoContrastEl = $('#auto-contrast');
    const dotStyleEl = $('#dot-style');
    const cornerSquareEl = $('#corner-square');
    const cornerDotEl = $('#corner-dot');
    const formatEl = $('#format');
    const logoEl = $('#logo');
    const logoSizeEl = $('#logo-size');
    const logoMarginEl = $('#logo-margin');
    const logoBgEl = $('#logo-bg');

    let logoDataUrl = null;

    function normalizeUrl(text) {
      try {
        // Accept arbitrary text as QR content, but if it looks like a URL without scheme, add https://
        const hasScheme = /^(https?:)?\/\//i.test(text);
        if (!hasScheme && /\./.test(text) && !text.includes(' ')) {
          return 'https://' + text;
        }
        return text;
      } catch { return text; }
    }

    // Read file as data URL
    function readFileAsDataUrl(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }

    // Initialize QR instance
    const qr = new QRCodeStyling({
      width: parseInt(sizeEl.value, 10),
      height: parseInt(sizeEl.value, 10),
      type: 'svg',
      data: normalizeUrl(dataEl.value),
      qrOptions: { errorCorrectionLevel: ecEl.value },
      image: undefined,
      imageOptions: { crossOrigin: 'anonymous', margin: parseInt(logoMarginEl.value, 10) },
      dotsOptions: { type: dotStyleEl.value, color: fgEl.value },
      cornersSquareOptions: { type: cornerSquareEl.value, color: fgEl.value },
      cornersDotOptions: { type: cornerDotEl.value, color: fgEl.value },
      backgroundOptions: { color: bgEl.value }
    });

    qr.append(document.getElementById('qr'));

    // Auto-contrast helper
    function ensureContrast(fg, bg) {
      // If auto-contrast on and contrast ratio is low, nudge fg darker/lighter.
      if (!autoContrastEl.checked) return fg;
      function luminance(hex){
        const c = hex.replace('#','');
        const rgb = c.length === 3 ? c.split('').map(x=>parseInt(x+x,16)) : [0,1,2].map(i=>parseInt(c.substr(2*i,2),16));
        const [r,g,b] = rgb.map(v=>{v/=255;return v<=0.03928? v/12.92 : Math.pow((v+0.055)/1.055,2.4)});
        return 0.2126*r+0.7152*g+0.0722*b;
      }
      function contrast(h1,h2){
        const L1 = luminance(h1) + 0.05;
        const L2 = luminance(h2) + 0.05;
        return L1>L2 ? (L1/L2) : (L2/L1);
      }
      let tries = 0;
      let out = fg;
      while (contrast(out, bg) < 2.5 && tries < 8) {
        // Shift foreground away from background: darker if bg is light, lighter if bg is dark.
        const bgLum = luminance(bg);
        const c = out.replace('#','');
        let [r,g,b] = [0,1,2].map(i=>parseInt(c.substr(2*i,2),16));
        const delta = bgLum > 0.5 ? -16 : 16;
        r = Math.max(0, Math.min(255, r + delta));
        g = Math.max(0, Math.min(255, g + delta));
        b = Math.max(0, Math.min(255, b + delta));
        out = '#' + [r,g,b].map(v=>v.toString(16).padStart(2,'0')).join('');
        tries++;
      }
      return out;
    }

    async function updateQR() {
      const size = Math.max(128, Math.min(2048, parseInt(sizeEl.value || '360', 10)));
      const data = normalizeUrl(dataEl.value || '');
      const ec = ecEl.value;
      const margin = parseInt(marginEl.value || '8', 10);
      const fg = ensureContrast(fgEl.value, transparentEl.checked ? '#ffffff' : bgEl.value);
      const bg = transparentEl.checked ? 'transparent' : bgEl.value;
      const dotType = dotStyleEl.value;
      const csType = cornerSquareEl.value;
      const cdType = cornerDotEl.value;
      const imgMargin = parseInt(logoMarginEl.value || '0', 10);

      const imageSizeRatio = Math.max(0.05, Math.min(0.45, (parseInt(logoSizeEl.value || '22', 10) / 100)));

      qr.update({
        width: size,
        height: size,
        data,
        qrOptions: { errorCorrectionLevel: ec },
        image: logoDataUrl || undefined,
        imageOptions: { crossOrigin: 'anonymous', margin: imgMargin, imageSize: imageSizeRatio },
        dotsOptions: { type: dotType, color: fg },
        cornersSquareOptions: { type: csType, color: fg },
        cornersDotOptions: { type: cdType, color: fg },
        backgroundOptions: { color: bg }
      });
    }

    // Event handlers
    $('#update').addEventListener('click', updateQR);
    [dataEl, sizeEl, ecEl, marginEl, fgEl, bgEl, transparentEl, autoContrastEl,
     dotStyleEl, cornerSquareEl, cornerDotEl, logoSizeEl, logoMarginEl].forEach(el => {
      el.addEventListener('input', updateQR);
      el.addEventListener('change', updateQR);
    });

    logoEl.addEventListener('change', async (e) => {
      const f = e.target.files?.[0];
      if (!f) { logoDataUrl = null; await updateQR(); return; }
      if (!f.type.startsWith('image/')) { alert('Please select an image file.'); return; }
      logoDataUrl = await readFileAsDataUrl(f);
      updateQR();
    });

    // Copy to clipboard (PNG)
    $('#copy').addEventListener('click', async () => {
      try {
        const blob = await qr.getRawData('png');
        await navigator.clipboard.write([new ClipboardItem({ [blob.type]: blob })]);
        notify('Copied PNG to clipboard');
      } catch (err) {
        console.error(err);
        notify('Copy failed in this browser');
      }
    });

    // Download
    $('#download').addEventListener('click', async () => {
      const fmt = formatEl.value;
      const name = 'qr.' + fmt;
      // For PNG/JPEG/WEBP we can set a background when transparent is on
      const opts = (fmt === 'png' || fmt === 'jpeg' || fmt === 'webp') && transparentEl.checked
        ? { background: logoBgEl.value }
        : undefined;
      qr.download({ name, extension: fmt, ...opts });
    });

    // Tiny toast
    function notify(text) {
      const t = document.createElement('div');
      t.textContent = text;
      t.style.cssText = 'position:fixed;left:50%;bottom:24px;transform:translateX(-50%);background:#111827;color:#fff;border:1px solid #232a3b;padding:10px 14px;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.25);z-index:9999;opacity:0;transition:opacity .2s ease';
      document.body.appendChild(t);
      requestAnimationFrame(()=>{ t.style.opacity = '1'; });
      setTimeout(()=>{ t.style.opacity = '0'; setTimeout(()=>t.remove(), 200); }, 1600);
    }

    // Initial render
    updateQR();
  </script>
</body>
</html>
